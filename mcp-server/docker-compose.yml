# Legal Intelligence MCP Hub - Docker Compose
# 
# Usage:
#   docker-compose up -d        # Start server
#   docker-compose logs -f      # View logs
#   docker-compose down         # Stop server

services:
  legal-mcp-hub:
    build:
      context: ..
      dockerfile: mcp-server/Dockerfile
    container_name: legal-mcp-hub
    ports:
      - "${MCP_PORT:-8000}:8000"
    environment:
      # Server
      - MCP_HOST=0.0.0.0
      - MCP_PORT=8000
      - LOG_LEVEL=${LOG_LEVEL:-INFO}

      # AWS S3
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-east-1}
      - S3_DEFAULT_BUCKET=${S3_DEFAULT_BUCKET:-legal-research-reports}

      # Court Listener
      - COURTLISTENER_API_KEY=${COURTLISTENER_API_KEY}
      - COURTLISTENER_BASE_URL=${COURTLISTENER_BASE_URL:-https://www.courtlistener.com/api/rest/v4}

      # Gemini
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}

      # Tavily (for web search retrieval)
      - TAVILY_API_KEY=${TAVILY_API_KEY}

      # GPT Researcher (inherited from parent)
      - FAST_LLM=${FAST_LLM:-google_genai:gemini-2.5-pro}
      - SMART_LLM=${SMART_LLM:-google_genai:gemini-2.5-pro}
      - STRATEGIC_LLM=${STRATEGIC_LLM:-google_genai:gemini-2.5-pro}
      - RETRIEVER=${RETRIEVER:-tavily}
    
    volumes:
      # Mount for local file access (Gemini file uploads)
      - ${LOCAL_FILES_PATH:-./data}:/app/data:ro
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  # Optional: Add a simple test client
  # test-client:
  #   image: python:3.12-slim
  #   depends_on:
  #     - legal-mcp-hub
  #   command: >
  #     python -c "
  #     import asyncio
  #     from mcp import Client
  #     async def test():
  #         async with Client('http://legal-mcp-hub:8000/mcp/') as client:
  #             result = await client.call_tool('health_check')
  #             print(result)
  #     asyncio.run(test())
  #     "

networks:
  default:
    name: legal-mcp-network

